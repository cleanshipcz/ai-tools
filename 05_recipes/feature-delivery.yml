id: feature-delivery
version: 1.0.0
description: Complete feature implementation workflow with build, review, refactor, and documentation cycles
tags:
  - workflow
  - feature
  - review
  - documentation
tools:
  - claude-code
  - copilot-cli
  - windsurf

# Conversation strategy: 'continue' (maintain context) or 'separate' (fresh conversation per agent)
conversationStrategy: separate

# Tool-specific options
toolOptions:
  copilot-cli:
    allowAllTools: true # Allow tools to run automatically without confirmation

variables:
  feature_description: '{{FEATURE_DESCRIPTION}}'
  acceptance_criteria: '{{ACCEPTANCE_CRITERIA}}'

steps:
  - id: analyze
    agent: project-planner
    task: |
      Analyze the following feature request in detail:

      Feature: {{feature_description}}

      Acceptance Criteria:
      {{acceptance_criteria}}

      Please analyze:
      1. The relevant parts of the codebase that will be affected
      2. Dependencies and integrations involved
      3. Potential challenges and risks
      4. Technical considerations (architecture, patterns, security, performance)
      5. Required changes to existing code
      6. New files or modules that need to be created

      Output your analysis as a comprehensive document covering all these aspects.
    outputDocument: '.recipe-docs/analysis.md'
    continueConversation: false
    waitForConfirmation: false

  - id: plan
    agent: project-planner
    task: |
      Based on the analysis, create a detailed implementation plan for:

      Feature: {{feature_description}}

      Create a step-by-step plan that includes:
      1. Order of implementation (which files/modules to create/modify first)
      2. Specific code changes needed in each file
      3. Test cases to be written
      4. Edge cases to handle
      5. Documentation updates needed
      6. Estimated complexity for each step

      Output your plan as a structured, actionable document that can guide implementation.
    outputDocument: '.recipe-docs/plan.md'
    includeDocuments:
      - '.recipe-docs/analysis.md'
    continueConversation: false
    waitForConfirmation: true

  - id: implement
    agent: feature-builder
    task: |
      Implement the following feature according to the analysis and plan:

      Feature: {{feature_description}}

      Acceptance Criteria:
      {{acceptance_criteria}}

      Follow the implementation plan and analysis documents carefully.
      Implement the feature with:
      - Clean, maintainable code
      - Proper error handling
      - Comprehensive tests
      - Documentation for public APIs

      Update the plan document as you progress to track what's been completed.
    includeDocuments:
      - '.recipe-docs/analysis.md'
      - '.recipe-docs/plan.md'
    continueConversation: false
    waitForConfirmation: false

  - id: review
    agent: code-reviewer
    task: |
      Review the changes made in the previous step against the plan and acceptance criteria, expect the highest quality.

      Focus on:
      - Adherence to the implementation plan
      - Code quality and maintainability
      - Test coverage and quality
      - Security concerns
      - Performance considerations
      - Documentation completeness

      Provide specific, actionable feedback.
    outputDocument: '.recipe-docs/review.md'
    includeDocuments:
      - '.recipe-docs/analysis.md'
      - '.recipe-docs/plan.md'
    continueConversation: false
    waitForConfirmation: false

  - id: refactor
    agent: refactoring-specialist
    task: |
      Address the review feedback from the previous step.

      Please:
      - Fix any issues identified
      - Improve code quality as suggested
      - Add missing tests or documentation
      - Ensure all acceptance criteria are met
      - Stay aligned with the original plan

      Update the review document with the changes made.
    includeDocuments:
      - '.recipe-docs/analysis.md'
      - '.recipe-docs/plan.md'
      - '.recipe-docs/review.md'
    continueConversation: false
    waitForConfirmation: false

  - id: quality-check
    agent: code-reviewer
    task: |
      Perform a final quality check on the implementation.

      Verify:
      - All review feedback has been addressed
      - Tests pass and cover edge cases
      - Code follows project conventions
      - Documentation is complete
      - Acceptance criteria are fully met

      Respond with "APPROVED" if quality standards are met, or provide remaining issues.
    includeDocuments:
      - '.recipe-docs/analysis.md'
      - '.recipe-docs/plan.md'
      - '.recipe-docs/review.md'
    continueConversation: false
    waitForConfirmation: true
    condition:
      type: always

  - id: document
    agent: documentation-writer
    task: |
      Update project documentation to reflect the new feature.

      Please update:
      - README.md with feature description
      - CHANGELOG.md with version entry
      - Any relevant architecture docs

      Use all the analysis, plan, and review documents as context for what was implemented.
    includeDocuments:
      - '.recipe-docs/analysis.md'
      - '.recipe-docs/plan.md'
      - '.recipe-docs/review.md'
    continueConversation: false
    waitForConfirmation: false
    condition:
      type: on-success
      check:
        type: contains
        value: 'APPROVED'

loop:
  steps:
    - review
    - refactor
  maxIterations: 3

metadata:
  author: ai-tools
  created: '2025-01-15'
