# Repository Reorganization Plan

## Overview

Add enumerated prefixes to top-level directories to improve organization, navigation, and logical grouping.

## Proposed Structure

### Foundation Layer (01-04) - Building Blocks in Dependency Order

- `rulepacks/` ‚Üí `01_rulepacks/` - Coding rules and standards (foundation for everything)
- `skills/` ‚Üí `02_skills/` - Executable commands and MCP integrations
- `prompts/` ‚Üí `03_prompts/` - Prompt manifests (uses rulepacks)
- `agents/` ‚Üí `04_agents/` - Agent manifests (uses prompts + rulepacks)

### Workflows & Projects (05-07)

- `recipes/` ‚Üí `05_recipes/` - Multi-agent workflow definitions (uses agents)
- `projects/` ‚Üí `06_projects/` - Project configurations (global/local)
- `mcp/` ‚Üí `07_mcp/` - MCP server configurations and presets

### Build System & Validation (10-12)

- `schemas/` ‚Üí `10_schemas/` - JSON Schema definitions
- `scripts/` ‚Üí `11_scripts/` - Build, validation, and utility scripts
- `templates/` ‚Üí `12_templates/` - Templates for adapter generation

### Configuration (15)

- `config/` ‚Üí `15_config/` - Runtime configuration (budgets, providers, deploy)

### Testing & Quality Assurance (20-21)

- `evals/` ‚Üí `20_evals/` - Evaluation framework and datasets
- `redteam/` ‚Üí `21_redteam/` - Security testing (jailbreaks, unsafe cases)

### Documentation & Learning (90-91)

- `docs/` ‚Üí `90_docs/` - Documentation files
- `examples/` ‚Üí `91_examples/` - Example usage and tutorials

### **No Change** - Generated/Build Artifacts

- `adapters/` - **KEEP AS-IS** (generated tool-specific outputs, gitignored - no need to reorganize)

## Rationale

### Grouping Strategy

1. **01-04**: Foundation layer in logical dependency order (rulepacks ‚Üí skills ‚Üí prompts ‚Üí agents)
2. **05-07**: Workflows and project management (recipes use agents, projects configure deployments)
3. **10-12**: Build system and infrastructure (stable, rarely changed)
4. **15**: Configuration (separate group)
5. **20-21**: Testing and quality assurance (distinct concern)
6. **90-91**: Documentation and examples (convention: docs at end)
7. **adapters/**: No change - generated files, gitignored

### Benefits

- **Logical Hierarchy**: Follows dependency order (rulepacks are foundation, agents build on prompts/rulepacks)
- **Discoverability**: Important folders listed first, in order of creation workflow
- **Scalability**: Gaps (01-04, then 10-12) allow future additions within each group
- **Consistency**: Follows common convention (docs at end), underscore format for prefixes
- **Readability**: Clear separation of concerns with logical grouping
- **Practical**: Generated files (adapters/) remain unchanged - no impact on gitignored outputs

## Migration Steps

### Phase 1: Prepare

1. ‚úÖ Create this reorganization plan
2. ‚òê Review all file references in scripts
3. ‚òê Update documentation with new paths
4. ‚òê Create migration script
5. ‚òê Test in a branch first

### Phase 2: Execute (Use git mv to preserve history)

```bash
# Foundation layer (dependency order)
git mv rulepacks 01_rulepacks
git mv skills 02_skills
git mv prompts 03_prompts
git mv agents 04_agents

# Workflows & projects
git mv recipes 05_recipes
git mv projects 06_projects
git mv mcp 07_mcp

# Build system
git mv schemas 10_schemas
git mv scripts 11_scripts
git mv templates 12_templates

# Configuration
git mv config 15_config

# Testing
git mv evals 20_evals
git mv redteam 21_redteam

# Documentation
git mv docs 90_docs
git mv examples 91_examples

# Generated files - NO CHANGE
# adapters/ stays as-is (gitignored, generated)
```

### Phase 3: Update References

#### Scripts (11_scripts/\*.ts)

All TypeScript scripts need path updates:

- `build.ts` - Updates: 01_rulepacks/, 04_agents/, 03_prompts/, 02_skills/, 12_templates/
- `validate.ts` - Updates: all manifest directories, 10_schemas/
- `gen-docs.ts` - Updates: 90_docs/, 04_agents/, 03_prompts/, 01_rulepacks/
- `gen-prompt-library.ts` - Updates: 03_prompts/
- `gen-prompt-html.ts` - Updates: 03_prompts/
- `gen-skills.ts` - Updates: 02_skills/
- `use-prompt.ts` - Updates: 03_prompts/
- `create-project.ts` - Updates: 06_projects/
- `gen-project.ts` - Updates: 06_projects/, 12_templates/
- `deploy-project.ts` - Updates: 06_projects/
- `external-projects.ts` - Updates: 06_projects/
- `init-project.ts` - Updates: 06_projects/
- `gen-features.ts` - Updates: 06_projects/
- `run-recipe.ts` - Updates: 05_recipes/
- `eval.ts` - Updates: 20_evals/, 15_config/
- `diff.ts` - No changes needed (adapters/ unchanged)
- `clean.ts` - Updates: 20_evals/ only (adapters/ unchanged)

#### Configuration Files

- `package.json` - Update script paths (scripts/ ‚Üí 11_scripts/)
- `tsconfig.json` - Update include paths (scripts/ ‚Üí 11_scripts/)
- `.gitignore` - No changes needed (adapters/ stays same, .output/ unchanged)
- `.github/workflows/*.yml` - Update any hardcoded paths to new directories

#### Documentation

- `README.md` - Update all folder references
- `90_docs/*.md` - Update cross-references
- `04_agents/README.md` - Update relative paths
- `03_prompts/README.md` - Update relative paths
- `01_rulepacks/README.md` - Update relative paths
- `02_skills/README.md` - Update relative paths
- `05_recipes/README.md` - Update relative paths
- `06_projects/README.md` - Update relative paths
- `07_mcp/README.md` - Update relative paths

#### Manifest Files

Check for any hardcoded paths in:

- Agent manifests (includes, references) - in 04_agents/
- Prompt manifests (includes from 03_prompts/shared/)
- Project manifests (feature paths, documentation references) - in 06_projects/

### Phase 4: Validation

```bash
# Validate all manifests still work
npm run validate

# Build adapters
npm run build

# Run tests
npm test

# Check for broken links in docs
# (manual review of README.md and docs/)
```

### Phase 5: Update Dependent Projects

If any external projects reference these paths:

- Update their `.cleanship-ai-tools/` symbolic links or paths
- Update any documentation that references folder structure
- Notify users through CHANGELOG.md

## Impact Assessment

### Low Impact (Minimal Changes Required)

- ‚úÖ `adapters/` - **NO CHANGE** - Generated, gitignored, rarely referenced
- ‚úÖ `config/` ‚Üí `15_config/` - Only referenced in eval.ts
- ‚úÖ `examples/` ‚Üí `91_examples/` - Standalone, few references
- ‚úÖ `redteam/` ‚Üí `21_redteam/` - Standalone, documentation only

### Medium Impact (Several Script Updates)

- ‚ö†Ô∏è `docs/` ‚Üí `90_docs/` - Many cross-references in README.md
- ‚ö†Ô∏è `evals/` ‚Üí `20_evals/` - Referenced in eval.ts and clean.ts
- ‚ö†Ô∏è `recipes/` ‚Üí `05_recipes/` - Referenced in run-recipe.ts
- ‚ö†Ô∏è `mcp/` ‚Üí `07_mcp/` - Referenced in documentation
- ‚ö†Ô∏è `templates/` ‚Üí `12_templates/` - Referenced in gen-project.ts

### High Impact (Many References Throughout)

- üî¥ `prompts/` ‚Üí `03_prompts/` - Referenced in multiple scripts, docs, templates
- üî¥ `agents/` ‚Üí `04_agents/` - Referenced in build, docs, templates
- üî¥ `rulepacks/` ‚Üí `01_rulepacks/` - Referenced in build, validation
- üî¥ `skills/` ‚Üí `02_skills/` - Referenced in build, gen-skills
- üî¥ `projects/` ‚Üí `06_projects/` - Referenced in many project-related scripts
- üî¥ `schemas/` ‚Üí `10_schemas/` - Referenced in validation, potentially imports
- üî¥ `scripts/` ‚Üí `11_scripts/` - Self-referential in package.json

## Risk Mitigation

### Backup Strategy

```bash
# Create backup before starting
git checkout -b reorganization-backup
git checkout -b feature/reorganize-folders
```

### Testing Strategy

1. Create feature branch
2. Perform reorganization
3. Run full test suite
4. Manual testing of key workflows:
   - `npm run validate`
   - `npm run build`
   - `npm run project:create test-proj`
   - `npm run project:generate test-proj`
   - `npm run use-prompt`
   - `npm run prompt-html`

### Rollback Plan

If issues arise:

```bash
git checkout main
git branch -D feature/reorganize-folders
```

## Timeline

**Estimated Effort**: 2-3 hours

1. **Preparation** (30 min)
   - Review all references
   - Create migration script

2. **Execution** (30 min)
   - Run git mv commands
   - Update package.json and tsconfig.json

3. **Update Scripts** (45 min)
   - Update all TypeScript files in 11_scripts/
   - Find and replace in batch where possible

4. **Update Documentation** (30 min)
   - Update README.md
   - Update all 90_docs/ files
   - Update individual directory READMEs

5. **Testing & Validation** (30 min)
   - Run validation
   - Run builds
   - Manual testing
   - Fix any issues

## Decision Points

### ‚úÖ DECIDED: Do NOT rename `adapters/`

- **Reason**: It's gitignored, generated output, no benefit to reorganizing
- **Impact**: Fewer file changes, less risk
- **Decision**: Keep `adapters/` as-is

### ‚úÖ DECIDED: Use underscore format `XY_`

- **Format**: `01_`, `02_`, etc. (2 digits with underscore)
- **Reason**: User preference, clear separation from hyphenated file names
- **Example**: `01_rulepacks/`, `11_scripts/`, `90_docs/`

### ‚ùì `.output/` directory?

- Generated directory for project outputs
- **Recommendation**: Keep as-is (starts with dot, clearly temporary)

## Post-Migration Checklist

- [ ] All scripts execute without errors
- [ ] `npm run validate` passes
- [ ] `npm run build` succeeds
- [ ] `npm test` passes
- [ ] Documentation links work
- [ ] README.md updated
- [ ] CHANGELOG.md entry created
- [ ] External project compatibility verified
- [ ] CI/CD pipeline passes

## Notes

- Use `git mv` exclusively to preserve git history
- Do NOT use `mv` command directly
- Commit changes in logical groups:
  1. Rename directories (git mv commands)
  2. Update package.json and tsconfig.json
  3. Update all scripts
  4. Update all documentation
  5. Update manifest files
- Consider incrementing version number (breaking change for external references)
