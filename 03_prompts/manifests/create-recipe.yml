id: create-recipe
version: 2.0.0
description: Clarify workflow steps and create a simple recipe.yml manifest

tags:
  - manifests
  - recipes
  - workflows
  - yaml

variables:
  - name: user_description
    required: true
    description: 'Brief description of the workflow or process'

rules:
  - 'Ask clarifying questions BEFORE generating the manifest'
  - 'Recommend keeping workflows simple (3-7 steps) but allow complexity when justified'
  - 'Each step should have one clear purpose'
  - 'Recommend document-first pattern (analysis → plan → implement) for multi-step workflows'

content: |
  The user wants to create a recipe based on this description:

  {{user_description}}

  **Your job is to clarify and translate:**

  1. **Ask clarifying questions:**
     - What is the overall goal of this workflow?
     - What are the main steps? (keep it high-level, 3-7 steps)
     - Which agents should perform each step?
     - Should steps produce documents for later steps to reference?
     - Which tools should run this? (copilot-cli, claude-code, cursor)

  2. **Suggest structure:**
     - Propose a kebab-case ID (e.g., feature-delivery, code-review-cycle)
     - Identify main steps (recommend starting with 3-7, can be more if needed)
     - Assign appropriate agents to steps
     - Apply document-first pattern if multi-step

  3. **Create recipe.yml with:**
     - id, version (1.0.0), description
     - tags: [workflow type]
     - steps: Array of steps, each with agent, prompt, outputDocument
     - Recommend pattern: analysis.md → plan.md → implementation (include prior docs)
     - tools: [copilot-cli, claude-code, cursor]
     - metadata: author, dates

  **Document-first pattern (recommended for multi-step workflows):**
  - Step 1: Analysis (outputDocument: .recipe-docs/analysis.md)
  - Step 2: Planning (outputDocument: .recipe-docs/plan.md, includeDocuments: [analysis.md])
  - Step 3+: Implementation (includeDocuments: [analysis.md, plan.md])

  **Start simple, allow complexity:**
  - Recommend 3-7 steps for clarity, but allow more if workflow requires it
  - Each step: agent, prompt/task, output
  - Simple workflows: ~60-100 lines; Complex workflows: as needed

  **Example:**

  User: "Workflow for delivering a new feature"

  You: "Questions:
  - Should it start with analysis/planning?
  - Need code review step?
  - Which agents? (feature-builder, code-reviewer, etc.)"

  User: "Yes analysis first, then implement, then review"

  You: "Perfect! I'll create 'feature-delivery' with:
  1. Analyze requirements (project-planner → analysis.md)
  2. Create plan (project-planner → plan.md, includes analysis)
  3. Implement (feature-builder → code, includes analysis + plan)
  4. Review (code-reviewer → review, includes all docs)
  Sound good?"

outputs:
  format: yaml
