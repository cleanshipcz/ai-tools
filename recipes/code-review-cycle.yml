id: code-review-cycle
version: 1.0.0
description: Iterative code review and improvement workflow until quality standards are met
tags:
  - review
  - refactor
  - quality
tools:
  - claude-code
  - copilot-cli
  - cursor

steps:
  - id: initial-review
    agent: code-reviewer
    task: |
      Perform a comprehensive code review of the current changes.

      Review checklist:
      - Code quality and maintainability
      - Design patterns and architecture
      - Error handling and edge cases
      - Test coverage and quality
      - Security vulnerabilities
      - Performance considerations
      - Documentation completeness
      - Adherence to project conventions

      Provide specific, actionable feedback organized by priority (Critical, High, Medium, Low).
      Rate overall quality on a scale of 1-10.
    continueConversation: false
    waitForConfirmation: false

  - id: apply-fixes
    agent: feature-builder
    task: |
      Address all Critical and High priority issues from the review.

      For each issue:
      - Implement the suggested fix
      - Add tests if applicable
      - Update documentation if needed

      Summarize the changes made.
    continueConversation: true
    waitForConfirmation: false

  - id: verify-fixes
    agent: code-reviewer
    task: |
      Verify that the issues have been properly addressed.

      Check:
      - All Critical issues are resolved
      - All High priority issues are resolved
      - New code follows best practices
      - Tests are adequate

      Respond with:
      - "PASS" if all issues are resolved and quality is acceptable (8+/10)
      - "CONTINUE" with remaining issues if more work is needed
    continueConversation: true
    waitForConfirmation: true

loop:
  steps:
    - apply-fixes
    - verify-fixes
  maxIterations: 5
  condition:
    type: command
    cmd: |
      # Exit if output contains "PASS" (exit code 0 = continue loop, non-zero = exit)
      if grep -q "PASS" /tmp/recipe-output.txt; then
        exit 1  # Exit loop
      else
        exit 0  # Continue loop
      fi

metadata:
  author: ai-tools
  created: "2025-01-15"
